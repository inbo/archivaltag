<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="archivaltag">
<title>G5pdst • archivaltag</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="G5pdst">
<meta property="og:description" content="archivaltag">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">archivaltag</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/archival-tags-data-structure.html">Archival tags data structure</a>
    <a class="dropdown-item" href="../articles/G5pdst.html">G5pdst</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/inbo/archivaltag/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>G5pdst</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inbo/archivaltag/blob/HEAD/vignettes/G5pdst.Rmd" class="external-link"><code>vignettes/G5pdst.Rmd</code></a></small>
      <div class="d-none name"><code>G5pdst.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document contains instructions and pseudo code to parse and read
archival tag data collected with G5pdst tags (<a href="https://cefastechnology.co.uk/" class="external-link">Cefas technology</a>).</p>
</div>
<div class="section level2">
<h2 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h2>
<p>Metadata start at the very begin of the file. We have only to define
when metadata end. Metadata end if a line starts with a specific pattern
which depends on the firmware version/build level.</p>
<p>Firmware version and build level are the first important metadata we
must detect. The lines containing such information start with
<code>"Firmware Version No,"</code> and
<code>"Firmware Build Level"</code> respectively. A way to extract the
firmware version is using the following regex:
<code>(?&lt;=Firmware Version No,).*</code>. A similar regex for the
firmware. In this document we will refer to the firmware version and
build level in the form <code>version.build_level</code>,
e.g. <code>3.40</code>. However, this is not mandatory. At the moment of
writing we have analysed data with the following
<code>firmware-version.build-level</code> pairs:</p>
<ul>
<li>3.80</li>
<li>3.40</li>
<li>2.70</li>
</ul>
<p>The string defining the end of the metadata section is:</p>
<ul>
<li>3.80 and 3.40: <code>"Daylog data for last deployment"</code>
</li>
<li>2.70: <code>"The following data are the Daylog contents"</code>
</li>
</ul>
<p>Notice also that the end of the metadata section defines
automatically the start of the daylog section.</p>
<p>The next information to extract is the <strong>tag ID</strong>. It
can be extract by using the regex:
<code>(?&lt;=Tag ID,)[A-Z|0-9]*</code> on the line starting with the
string <code>"Tag ID"</code>.</p>
<p>Another important information is the number of sensors embeded in the
tag. This information can be found in the line starting with
<code>"No of sensors"</code>. Regex:
<code>(?&lt;=No of sensors ,).*</code>.</p>
<p>For files with <code>firmware-version.build-level</code> =
<code>3.80</code> the number of days the tag was alive is mentioned in
the metadata. you can search for a line starting with
<code>"Total Days Alive"</code>. Regex: <code>(?&lt;=\= )\d+</code>.</p>
<p>We limited to extract essential metadata information. Extracting
other metadata is totally possible, of course.</p>
<p>Here below a pseudo code as recap.</p>
<pre><code>// Get firmware version and build level
WHILE line NOT START WITH "TAG ID"
  IF line START WITH "Firmware Version No,"
      firmware = EXTRACT FROM line WITH regex "(?&lt;=Firmware Version No,).*"
  IF line START WITH "Firmware Version No,"
      build_level = EXTRACT FROM line WITH regex "(?&lt;=Firmware Build Level,).*"
  READ next line
version = firmware.build_level

// Detect pattern (p) which ends the metadata section
IF (version IN ("3.80", "3.40"))
  p = "Daylog data for last deployment"
ELSE IF (version == "2.70")
  p = "The following data are the Daylog contents"
ELSE ERROR: 'version not supported'

// Parse the rest of metadata. It can be extended.
WHILE line NOT START WITH p
  
  // TagID
  IF line START WITH "Tag ID"
    tagID = EXTRACT FROM line WITH regex "(?&lt;=Tag ID,)[A-Z|0-9]*"
  
  // Number of sensors
  IF line START WITH "No of sensors ,"
    sensorsNo = EXTRACT FROM line WITH regex "(?&lt;=No of sensors ,).*"
  
  // Total days deployment duration
  IF line START WITH "Total Days Alive"
    deployment_days = EXTRACT FROM line WITH regex "(?&lt;=\= )\d+"</code></pre>
</div>
<div class="section level2">
<h2 id="daylog">Daylog<a class="anchor" aria-label="anchor" href="#daylog"></a>
</h2>
<p>The daylog section follows the metadata. The pattern used to find the
end of the metadata section marks the begin of the daylog section. An
empty line marks the end of the section. The first line after the
pattern contains the column names. You can alternatively use a match
condition as the line with the column names starts always with
<code>"Mission Day"</code>. The column names and the data following in
the other lines are comma separated.</p>
<pre><code>WHILE line NOT EQUAL TO ""
  
  // Detect column names
  IF line START WITH "Mission Day"
    col_names = SPLIT line BY ","
  // Detect and add data row
  ELSE 
    daylog += SPLIT line BY ","</code></pre>
</div>
<div class="section level2">
<h2 id="data-blocks">Data blocks<a class="anchor" aria-label="anchor" href="#data-blocks"></a>
</h2>
<p>The data blocks follow the daylog section. They are separated by
deveral empty lines. Data blocks are numbered starting from 0. So, the
first data block can be detected by a line called
<code>"Data Block 0"</code>. A number of lines follow containing
important sensor data related information, see below:</p>
<pre><code>Data Block 0
Start Time = 01/09/2008 00:01:00
Stop Time = 01/09/2009 00:01:00
Logging rate = 30
Resolution = 12
Data points available = 591736
Date/Time Stamp,Pressure</code></pre>
<p>In particular, the number of “data points available” can be useful as
it allows us to identify the start and the end of block easily. Let’s
call it <em>n</em>, in our example above <code>n = 591736</code>. And
also let’s say that this line has number <code>i</code>. The column
names of the data block are defined in the line <code>i+1</code> and are
comma separated. The sensor variable(s) is/are defined next the
“Date/Time Stamp,”. In example above we know that the data block refers
to <code>"Pressure"</code> values. In case of acceleration data, we will
have three variables: <code>"Gee X,Gee Y, Gee Z"</code>. The last line
of the data block has number <code>i+1+n</code>.</p>
<p>A second data block, <code>Data Block 1</code>, can start after the
end of the first data block. The two data blocks are separated by
several empty lines.</p>
<p>Notice that the number of measurements per time unit is sensor
dependent. Here below an example from a tag measuring pressure and
temperature:</p>
<pre><code>Data Block 0
Start Time = 01/09/2008 00:01:00
Stop Time = 01/09/2009 00:01:00
Logging rate = 30
Resolution = 12
Data points available = 591736
Date/Time Stamp,Pressure
01/09/2008 00:01:00,1.37
01/09/2008 00:01:30,1.37
01/09/2008 00:02:00,1.37
01/09/2008 00:02:30,1.37
...</code></pre>
<pre><code>Data Block 1
Start Time = 01/09/2008 00:01:00
Stop Time = 01/09/2009 00:01:00
Logging rate = 300
Resolution = 12
Data points available = 59172
Date/Time Stamp,Temp
01/09/2008 00:01:00,20.813
01/09/2008 00:06:00,20.797
01/09/2008 00:11:00,20.797
01/09/2008 00:16:00,20.797
...</code></pre>
<p>Notice how the logging rate is the number of seconds between two
measurements: 30 seconds for pressure and 5 minutes, or 300s, for
temperature.</p>
</div>
<div class="section level2">
<h2 id="issues">Issues<a class="anchor" aria-label="anchor" href="#issues"></a>
</h2>
<p>Here below a list of issues found while reading file
<code>A15881_04-09-2020.csv</code>. Even if we can exclude this file
from being imported, it gives us an idea about the reasons behind
potential parsing errors.</p>
<ul>
<li>One or more commas at the end of each line. A cleaning was performed
along the entire file by removing the regex pattern <code>",{5,}"</code>
at each line.</li>
<li>Data block 0 doesn’t exists, only <code>Data block 1</code>.</li>
<li>The datetime format is not constant along the data block. Both
<code>d/m/y H:M</code> and <code>d/m/y H:M:S</code> are used.</li>
<li>Some datetime values are not unique, but repeated in multiple rows.
It occurs in rows with datetime format <code>d/m/y H:M</code>. Seconds
can be added by assessing the number of rows per datetime: if there are
30 rows per minute, the datetime values are separated by 2 seconds, if
60 rows are present, they are separated by 1 second.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://twitter.com/damianozingaro" class="external-link">Damiano Oldoni</a>, <a href="https://twitter.com/VerhelstPJ" class="external-link">Pieterjan Verhelst</a>, <a href="https://lifewatch.be" class="external-link"><img src="https://www.lifewatch.be/sites/lifewatch.be/themes/lifewatchportal/images/header_lw_logo.png" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
